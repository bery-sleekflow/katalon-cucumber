name: Katalon CI/CD

on:
  push:
    branches:
      - master
      - ci-cd-integration
  pull_request:
    branches:
      - master
  workflow_dispatch:

jobs:
  katalon:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Java 17
      uses: actions/setup-java@v3
      with:
        java-version: 17
        distribution: 'temurin'

    - name: Install Katalon Studio
      run: |
        curl -O https://download.katalon.com/9.x/Katalon_Studio_Engine_Linux_64-9.x.zip 
        unzip Katalon_Studio_Engine_Linux_64-9.x.zip -d /opt/katalon
        export KATALON_HOME=/opt/katalon/Katalon_Studio_Engine_Linux_64-9.x

    - name: Run Katalon Test Suite
      run: |
        $KATALON_HOME/katalonc \
          -projectPath="$(pwd)/e2e-web.prj" \
          -retry=0 \
          -testSuitePath="Test Suites/Regression Web" \
          -executionProfile="CICD" \
          -browserType="Chrome" \
          -reportFolder="$(pwd)/report" \
          -apiKey="${{ secrets.KATALON_API_KEY }}" \
          --config -webui.autoUpdateDrivers=true \
          -Dwebdriver.chrome.options="--no-sandbox --disable-dev-shm-usage --disable-gpu"

    - name: Upload test reports
      uses: actions/upload-artifact@v3
      with:
        name: test-report
        path: report/